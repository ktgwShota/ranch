# Choisur

Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã« Cloudflare D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’çµ±åˆã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚
OpenNext (@opennextjs/cloudflare) ã‚’åˆ©ç”¨ã—ã¦ã€Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Cloudflare Workers ä¸Šã§å‹•ä½œã•ã›ã¦ã„ã¾ã™ã€‚

## ğŸš€ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### âš›ï¸ ã‚³ã‚¢
- **TypeScript**  
  é™çš„å‹ä»˜ã‘è¨€èª
- **React 19.2.3**  
  UI æ§‹ç¯‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **Next.js 15.1.4**  
  ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ React ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆApp Router / Server Actionsï¼‰

---

### â˜ï¸ ã‚¤ãƒ³ãƒ•ãƒ©
- **Cloudflare Workers**  
  ã‚¨ãƒƒã‚¸å®Ÿè¡Œç’°å¢ƒ
- **Cloudflare D1**  
  SQLite äº’æ›ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **OpenNext (@opennextjs/cloudflare)**  
  Cloudflare Workers å‘ã‘ Next.js å®Ÿè¡Œã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
- **Wrangler**  
  Cloudflare Workers ç®¡ç† CLI ãƒ„ãƒ¼ãƒ«

---

### ğŸ—ƒï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ / ORM
- **Drizzle ORM**  
  TypeScript å‘ã‘ ORM
- **Drizzle Kit**  
  ã‚¹ã‚­ãƒ¼ãƒãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ãƒ„ãƒ¼ãƒ«
- **Drizzle Zod**  
  Drizzle Ã— Zod é€£æºãƒ©ã‚¤ãƒ–ãƒ©ãƒª

---

### ğŸ§© çŠ¶æ…‹ç®¡ç†
- **Zustand**  
  ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

---

### ğŸ§¾ ãƒ•ã‚©ãƒ¼ãƒ  / ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **React Hook Form**  
  ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **Zod v4.3.4**  
  ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **@hookform/resolvers**  
  React Hook Form å‘ã‘ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é€£æºã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼

---

### ğŸ¨ UI / ãƒ‡ã‚¶ã‚¤ãƒ³
- **shadcn/ui**  
  Radix UI ãƒ™ãƒ¼ã‚¹ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé›†
- **Radix UI**  
  ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŸºç›¤
- **Tailwind CSS v4**  
  ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ CSS ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **Lucide React**  
  React å‘ã‘ã‚¢ã‚¤ã‚³ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

---

### ğŸ› ï¸ å“è³ªç®¡ç† / ãƒ†ã‚¹ãƒˆ
- **Biome**  
  ãƒªãƒ³ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ•´ç†ãƒ„ãƒ¼ãƒ«
- **Playwright**  
  E2E ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«

---

## ğŸ“Š ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰æ§‹é€ 
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®è²¬å‹™ã§åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ã€‚

1. **UI Layer (`app/`, `components/`)**: Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨Next.js Pagesã€‚
2. **Action Layer (`**/actions.ts`)**: Server Actionsã€‚UIã¨Service Layerã®ä»²ä»‹å½¹ã€‚
3. **Service Layer (`src/db/services/`)**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€‚Drizzle ORMã‚’ä½¿ç”¨ã—ãŸDBæ“ä½œã€‚
4. **Validation Layer (`src/db/validation/`)**: Zodã«ã‚ˆã‚‹å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
5. **Data Layer (`src/db/core/`)**: Drizzleã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã¨æ¥ç¶šè¨­å®šã€‚

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ãƒ•ãƒ­ãƒ¼
```
Cloudflare Worker (Entrypoint)
    â†“
.open-next/worker.js (OpenNext Generated)
    â†“
Next.js App Router / Server Actions
    â†“
Service Layer (Drizzle ORM)
    â†“
D1 Database Access (via Binding)
```

---

## ï¿½ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ app/                  # Next.js App Router (ãƒšãƒ¼ã‚¸ã€Server Actions)
â”‚   â”œâ”€â”€ (home)/          # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ polls/           # åº—æ±ºã‚ï¼ˆå¤šæ•°æ±ºï¼‰æ©Ÿèƒ½
â”‚   â””â”€â”€ schedule/        # æ—¥ç¨‹èª¿æ•´æ©Ÿèƒ½
â”œâ”€â”€ components/           # å…±é€š React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (UIãƒ‘ãƒ¼ãƒ„)
â”œâ”€â”€ db/                   # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£
â”‚   â”œâ”€â”€ core/            # ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã€æ¥ç¶šè¨­å®š (drizzle.ts)
â”‚   â”œâ”€â”€ services/        # DBã‚¢ã‚¯ã‚»ã‚¹ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ (ORMæ“ä½œ)
â”‚   â””â”€â”€ validation/      # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒ (Zod / drizzle-zod)
â”œâ”€â”€ hooks/                # ã‚«ã‚¹ã‚¿ãƒ  React Hooks
â”œâ”€â”€ lib/                  # å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¨­å®šãƒ»åˆæœŸåŒ– (MUI, Dayjs)
â”œâ”€â”€ stores/               # Zustand ã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†
â”œâ”€â”€ types/                # å…±é€šå‹å®šç¾©
â””â”€â”€ utils/                # æ±ç”¨çš„ãªç´”ç²‹é–¢æ•° (æ—¥ä»˜, OGP, URL, Styles)
```

### é–‹ç™ºãƒ«ãƒ¼ãƒ«
- `lib` ã¯ã€Œå¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¨­å®šï¼ˆåˆæœŸåŒ–ï¼‰ã€ã®ã¿ã‚’ç½®ãã¾ã™ï¼ˆä¾‹: `lib/dayjs.ts` ã§æ—¥æœ¬èªåŒ–è¨­å®šï¼‰ã€‚
- `utils` ã¯ã€Œã‚¢ãƒ—ãƒªç‹¬è‡ªã®å‡¦ç†ï¼ˆç´”ç²‹é–¢æ•°ï¼‰ã€ã‚’ç½®ãã¾ã™ï¼ˆä¾‹: `utils/date.ts` ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡¦ç†ï¼‰ã€‚
- **DBæ“ä½œ**: ç›´æ¥ `app` ã‚„ `actions` ã§ `drizzle` ã‚’å©ã‹ãšã€å¿…ãš `src/db/services` çµŒç”±ã§è¡Œã„ã¾ã™ã€‚

---

## ğŸ› ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 2. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æº–å‚™

ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ã®D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆSQLiteï¼‰ã‚’ä½œæˆã—ã€ã‚¹ã‚­ãƒ¼ãƒã‚’é©ç”¨ã—ã¾ã™ã€‚

```bash
npm run db:setup
```

### 3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

**A. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å…ˆè¡Œé–‹ç™º (é«˜é€Ÿ)**
UIã‚„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ã«é©ã—ã¦ã„ã¾ã™ã€‚
â€» D1ã¸ã®å®Ÿéš›ã®ä¿å­˜ã¯è¡Œã‚ã‚Œã¾ã›ã‚“ï¼ˆãƒ¢ãƒƒã‚¯æ¨å¥¨ï¼‰ã€‚

```bash
npm run dev
# -> http://localhost:3000
```

**B. API / ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºé–‹ç™º**
Cloudflare Pages äº’æ›ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã—ã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å®Ÿéš›ã«æ¥ç¶šã—ã¦å‹•ä½œç¢ºèªãŒã§ãã¾ã™ã€‚

```bash
npm run dev:cf
# -> http://localhost:8788
```

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç®¡ç†
Drizzle Kitã‚’ä½¿ç”¨ã—ã¦ã‚¹ã‚­ãƒ¼ãƒã®å¤‰æ›´ã‚’ç®¡ç†ã—ã¾ã™ã€‚

```bash
# ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã‹ã‚‰ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
npx drizzle-kit generate

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ­ãƒ¼ã‚«ãƒ«DBã«é©ç”¨
npm run db:setup
```

### ãƒ‡ãƒãƒƒã‚°
```bash
# ä»»æ„ã®SQLã‚’å®Ÿè¡Œ
npm run db:query -- "SELECT * FROM polls LIMIT 5"
```

---

## ï¿½ åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
| --- | --- |
| `npm run dev` | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹• (Next.js) |
| `npm run dev:cf` | Cloudflare äº’æ›ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹• |
| `npm run build:cf` | Cloudflare å‘ã‘ã®ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ |
| `npm run deploy:prd` | æœ¬ç•ªç’°å¢ƒ (Production) ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ |
| `npm run db:setup` | ãƒ­ãƒ¼ã‚«ãƒ«DBã®ä½œæˆãƒ»åˆæœŸåŒ– |
| `npm run db:reset` | ãƒ­ãƒ¼ã‚«ãƒ«DBã®å®Œå…¨åˆæœŸåŒ– |
| `npm run check:fix` | Biome ã«ã‚ˆã‚‹ä¸€æ‹¬ã‚³ãƒ¼ãƒ‰ä¿®æ­£ (Lint, Format, Imports) |
| `npm run cf-typegen` | Cloudflare ã®å‹å®šç¾©è‡ªå‹•ç”Ÿæˆ |
